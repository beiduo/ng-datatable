"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e,n){function a(t,e){var a=this;this.buildData=function(t,e){a.receive=e,a.config=t,a.data=a.buildGroup(t,e),a.dataFilter(),a.dataSort(),a.rows=a.buildPlainRows()},this.buildData=this.buildData.bind(this),this.dataFilter=function(){var t=a,e=a.config.params;"object"===("undefined"==typeof e?"undefined":_typeof(e))&&Object.keys(e).forEach(function(a){if(null!==e[a]&&e[a]!==n&&""!==e[a]){var l=t.config.cols.find(function(t){return t.field===a});l&&"object"===_typeof(l.filterOptions)&&t.data.rows.forEach(function(t){t.children=t.children.filter(function(t){return t.entity[a]===l.filterOptions.find(function(t){return t.value===e[a]}).name})})}})},this.dataSort=function(){var t=a;a.data.rows.forEach(function(e){var n=t.config.sortOptions;e.children=e.children.sort(function(t,e){return"desc"===n.order?e.entity[n.sortBy]-t.entity[n.sortBy]:t.entity[n.sortBy]-e.entity[n.sortBy]})})},this.buildGroup=function(t,e){var n={};return t.enableGrouping?n.rows=e.rows.map(function(e){var n={};return"object"===_typeof(e[t.groupBy])?n.parent=Object.assign({},e[t.groupBy]):n.parent={name:e[t.groupBy]},Array.isArray(e[t.groupIn])&&(n.children=e[t.groupIn].map(function(t){return{entity:t}})),n}):n.rows=[{children:e.rows.map(function(t){return{entity:t}})}],"function"==typeof t.dataSerialize&&n.rows.forEach(function(e){e.children.forEach(function(e){e.entity=t.dataSerialize(e.entity)})}),n},this.buildPlainRows=function(){var t=[];return a.data.rows.forEach(function(e){e.children.forEach(function(e){t[t.length]=e})}),t},this.onSelectAll=function(){var t=a.config.isRowSelectable;a.allSelected?(a.rows.forEach(function(e){("function"!=typeof t||t(e))&&(e.isSelected=!0)}),a.data.rows.forEach(function(t){t.isSelected=!0})):(a.rows.forEach(function(e){("function"!=typeof t||t(e))&&(e.isSelected=!1)}),a.data.rows.forEach(function(t){t.isSelected=!1}))},this.onSort=function(t){"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(a.config.sortOptions=Object.assign({},a.config.sortOptions,t),"function"==typeof a.config.onFetch?a.config.onFetch(Object.assign({},a.config.params,a.config.sortOptions)):(a.dataSort(),a.rows=a.buildPlainRows()))},this.onSort=this.onSort.bind(this),this.onParamsChange=function(t,e){"string"==typeof t&&(a.config.params[t]=e?e.value:null),"function"==typeof a.config.onFetch?a.config.onFetch(Object.assign({},a.config.params,a.config.sortOptions)):a.buildData(a.config,a.receive)},this.onParamsChange=this.onParamsChange.bind(this),this.getThClass=function(t){var e=[];return t.alignRight&&e.push("align-right"),e.push("col-"+t.field+"-th"),e.join(" ")},this.$onInit=function(){var t=a;a.colViews={},a.templateUrls={table:"ng-datatable-table.html",th:"ng-datatable-th.html",thFilter:"ng-datatable-th-filter.html",groupHeader:"ng-datatable-group-header.html",ceil:"ng-datatable-ceil.html"},"string"==typeof a.config.tableTemplateUrl&&(a.templateUrls.table=a.config.tableTemplateUrl),"string"==typeof a.config.tableTemplate&&(e.put("ng-datatable-custom-table",a.config.tableTemplate),a.templateUrls.table="ng-datatable-custom-table"),"string"==typeof a.config.theadCeilTemplateUrl&&(a.templateUrls.th=a.config.theadCeilTemplateUrl),"string"==typeof a.config.theadCeilTemplate&&(e.put("ng-datatable-custom-th",a.config.theadCeilTemplate),a.templateUrls.th="ng-datatable-custom-th"),"string"==typeof a.config.filterTemplateUrl&&(a.templateUrls.thFilter=a.config.filterTemplateUrl),"string"==typeof a.config.filterTemplate&&(e.put("ng-datatable-custom-th-filter",a.config.filterTemplate),a.templateUrls.thFilter="ng-datatable-custom-th-filter"),"string"==typeof a.config.groupHeaderTemplateUrl&&(a.templateUrls.groupHeader=a.config.groupHeaderTemplateUrl),"string"==typeof a.config.groupHeaderTemplate&&(e.put("ng-datatable-custom-group-header",a.config.groupHeaderTemplate),a.templateUrls.groupHeader="ng-datatable-custom-group-header"),"string"==typeof a.config.ceilTemplateUrl&&(a.templateUrls.ceil=a.config.ceilTemplateUrl),"string"==typeof a.config.ceilTemplate&&(e.put("ng-datatable-custom-ceil",a.config.ceilTemplate),a.templateUrls.ceil="ng-datatable-custom-ceil"),a.config.cols.forEach(function(n){return"string"!=typeof n.field?void console.error("each column must has a field property, otherwise some functions might not work. if this column doesn't connect with any field in your data, just use any radom field name."):("string"==typeof n.theadCeilTemplateUrl&&(t.templateUrls["th_"+n.field]=n.theadCeilTemplateUrl),"string"==typeof n.filterTemplateUrl&&(t.templateUrls["filter_"+n.field]=n.filterTemplateUrl),"string"==typeof n.ceilTemplateUrl&&(t.templateUrls["ceil_"+n.field]=n.ceilTemplateUrl),"string"==typeof n.theadCeilTemplate&&(e.put("ng-datatable-th_"+n.field,n.theadCeilTemplate),t.templateUrls["th_"+n.field]="ng-datatable-th_"+n.field),"string"==typeof n.filterTemplate&&(e.put("ng-datatable-th-filter_"+n.field,n.filterTemplate),t.templateUrls["thFilter_"+n.field]="ng-datatable-th-filter_"+n.field),void("string"==typeof n.ceilTemplate&&(e.put("ng-datatable-ceil_"+n.field,n.ceilTemplate),t.templateUrls["ceil_"+n.field]="ng-datatable-ceil_"+n.field)))}),a.config.enableGrouping&&(a.config=Object.assign({},{groupBy:"parent",groupIn:"chilren"},a.config)),a.config.sortOptions=Object.assign({},a.config.sortDefaults),a.buildData(a.config,a.receive),a.api={getRows:function(){return a.rows},getSelections:function(){return a.rows.filter(function(t){return t.isSelected})},selectAllRows:function(){a.allSelected=!0,a.onSelectAll()},unselectAllRows:function(){a.allSelected=!1,a.onSelectAll()},getRowsBy:function(t){return a.rows.filter(function(e){return Object.keys(t).every(function(n){return t[n]===e.entity[n]})})},getParams:function(){return a.config.params},setData:function(t){a.buildData(a.config,t)},setParams:function(t){var e=a;return"object"!==("undefined"==typeof t?"undefined":_typeof(t))?void console.error("setParams method requires an object as its first parameter"):(a.config.params=Object.assign({},a.config.params,t),a.onParamsChange(),void Object.keys(t).forEach(function(a){var l=void 0;l=null===t[a]||t[a]===n||""===t[a]?null:e.colViews[a].ngDatatableThFilter.options.find(function(e){return e.value===t[a]}),e.colViews[a].ngDatatableThFilter.setSelected(l)}))},getView:function(){return a},disableSelection:function(){a.config.enableSelection=!1},enableSelection:function(){a.config.enableSelection=!0},toggleSelection:function(){a.config.enableSelection=!a.config.enableSelection},disableGroupHeaderSelection:function(){a.config.enableGroupHeaderSelection=!1},enableGroupHeaderSelection:function(){a.config.enableGroupHeaderSelection=!0},disableSelectAll:function(){a.config.enableSelectAll=!1},enableSelectAll:function(){a.config.enableSelectAll=!0}},Object.keys(a.api).forEach(function(e){a.api[e]=a.api[e].bind(t)}),"function"==typeof a.config.apiRegister&&a.config.apiRegister(a.api)},console.log(this)}var l;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}a.$inject=["$timeout","$templateCache"],l.component("ngDatatable",{bindings:{config:"<",receive:"<"},template:"<ng-include src=\"vm.templateUrls['table']\"></ng-include>",controller:a,controllerAs:"vm"})}(window,window.angular),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-ceil.html","<div class=\"ceil\">{{vm.applyFilter(vm.row.entity[vm.field], vm.col.filter) || '-'}}</div>")}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-group-header.html",'<div class="ceil"><div class="group-caption">{{vm.receive.name}}</div><a href="javascript:;" class="triangle group-trigger" ng-class="{\'group-trigger-open\': vm.ngDatatableGroup.status.groupOpen}">收起</a></div>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-group.html",'<tr class="group-header" ng-if="vm.group.parent"><td class="select-ceil" ng-if="vm.root.config.enableSelection"><div class="ceil" ng-if="vm.root.config.enableGroupHeaderSelection"><label class="ng-datatable-check"><input type="checkbox" ng-model="vm.group.isSelected" ng-click="vm.onGroupSelect()"> <span class="text"></span></label></div></td><td colspan="{{vm.root.config.cols.length}}"><ng-datatable-group-header ng-click="vm.onGroupOpen()" receive="vm.group.parent" root="vm.root"></ng-datatable-group-header></td></tr><tr ng-datatable-row="" ng-repeat="el in vm.group.children" row="el" group="vm.group" ng-show="vm.status.groupOpen" root="vm.root"></tr>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-row.html",'<td class="select-ceil" ng-if="vm.root.config.enableSelection"><div class="ceil"><label class="ng-datatable-check"><input type="checkbox" ng-disabled="!vm.root.config.isRowSelectable(vm.row)" ng-model="vm.row.isSelected" ng-change="vm.onRowSelect()"> <span class="text"></span></label></div></td><td ng-repeat="el in vm.root.config.cols" data-ref="{{el.field}}" ng-class="vm.getTdClass(el)"><ng-datatable-ceil field="el.field" row="vm.row" col="el" root="vm.root"></ng-datatable-ceil></td>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-table.html",'<table class="maintable"><thead><tr><th class="select-ceil" ng-if="vm.config.enableSelection"><div class="ceil" ng-if="vm.config.enableSelectAll"><label class="ng-datatable-check"><input type="checkbox" ng-model="vm.allSelected" ng-change="vm.onSelectAll()"> <span class="text"></span></label></div></th><th ng-repeat="el in vm.config.cols" data-ref="el.field" ng-class="vm.getThClass(el)"><ng-datatable-th col="el" config="vm.config" root="vm"></ng-datatable-th></th></tr></thead><tbody ng-datatable-group="" ng-repeat="el in vm.data.rows" group="el" root="vm"></tbody></table>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-th-filter.html",'<ul class="filter-options"><li ng-class="{ current: !vm.status.selected }"><a href="javascript:;" ng-click="vm.onfilterSelect(null)">全部</a></li><li ng-repeat="option in vm.options track by $index" ng-class="{ current: option == vm.status.selected }"><a href="javascript:;" ng-click="vm.onfilterSelect(option)">{{option.name}}</a></li></ul>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-th.html",'<div class="thead-ceil with-filter"><div class="title">{{vm.col.displayName}}</div><a href="javascript:;" class="sort" ng-if="vm.col.enableSort" ng-class="{ \'sort-asc\': vm.config.sortOptions.sortBy === vm.col.field && vm.config.sortOptions.order === \'asc\', \'sort-desc\': vm.config.sortOptions.sortBy === vm.col.field && vm.config.sortOptions.order === \'desc\' }" ng-click="vm.onSort()"><span class="text">排序</span></a> <a href="javascript:;" class="triangle filter-trigger" ng-class="{ \'filter-trigger-open\': vm.status.filterOpen }" ng-click="vm.onFilterTrigger()" ng-if="vm.col.enableFilter">过滤</a><ng-datatable-th-filter ng-class="{show: vm.status.filterOpen}" ng-if="vm.col.enableFilter" options="vm.col.filterOptions" col="vm.col" root="vm.root"></ng-datatable-th-filter></div>')}])}(),function(t,e,n){function a(t){var e=this;this.getTemplateUrl=function(){var t=e.root.templateUrls;return t["ceil_"+e.col.field]||t.ceil},this.applyFilter=function(n,a){if(a){var l=a.split(":"),o=l[0],i=[n];return l.length>1&&(i=i.concat(l.slice(1))),t(o).apply(e,i)}return n}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}a.$inject=["$filter"],l.component("ngDatatableCeil",{bindings:{row:"<",field:"<",col:"<",root:"<"},require:{ngDatatableRow:"^"},template:'<ng-include src="vm.getTemplateUrl()"></ng-include>',controller:a,controllerAs:"vm"})}(window,window.angular),function(t,e,n){function a(){}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.component("ngDatatableGroupHeader",{bindings:{receive:"<",root:"<"},require:{ngDatatableGroup:"^"},template:"<ng-include src=\"vm.root.templateUrls['groupHeader']\"></ng-include>",controller:a,controllerAs:"vm"})}(window,window.angular),function(t,e,n){function a(){var t=this;this.status={groupOpen:!0},this.onGroupOpen=function(){t.status.groupOpen=!t.status.groupOpen},this.onGroupOpen=this.onGroupOpen.bind(this),this.onGroupSelect=function(){var e=t.root.config.isRowSelectable;t.group.isSelected?t.group.children.forEach(function(t){("function"!=typeof e||e(t))&&(t.isSelected=!0)}):(t.root.allSelected=!1,t.group.children.forEach(function(t){("function"!=typeof e||e(t))&&(t.isSelected=!1)}))},this.$onInit=function(){t.root=t.ngDatatable}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.directive("ngDatatableGroup",function(){return{restrict:"EA",templateUrl:"ng-datatable-group.html",scope:{group:"="},require:{ngDatatable:"^"},controller:a,controllerAs:"vm",bindToController:!0}})}(window,window.angular),function(t,e,n){function a(){var t=this;this.onRowSelect=function(){t.row.isSelected||(t.root.allSelected=!1,t.group.isSelected=!1)},this.getTdClass=function(t){var e=[];return t.alignRight&&e.push("align-right"),e.push("col-"+t.field+"-td"),e.join(" ")}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.directive("ngDatatableRow",function(){return{restrict:"EA",templateUrl:"ng-datatable-row.html",scope:{row:"=",group:"=",root:"="},require:{ngDatatableGroup:"^"},controller:a,controllerAs:"vm",bindToController:!0}})}(window,window.angular),function(t,e,n){function a(t,e,n,a){function l(t){var n=e[0],a=n.parentNode.querySelector("a.filter-trigger"),l=t.target,o=!1;if(t&&l&&n){for(;l;l=l.parentNode)if(l===n||l===a){o=!0;break}o||r.onClose()}}function o(){return"ontouchstart"in window||navigator.maxTouchPoints}var i=this,r=this;this.status={},this.getTemplateUrl=function(){var t=i.root.templateUrls;return t["thFilter_"+i.col.field]||t.thFilter},this.onClose=function(){var e=i;t.$apply(function(){e.ngDatatableTh.status.filterOpen=!1})},this.onfilterSelect=function(t){i.status.selected=t,i.ngDatatableTh.status.filterOpen=!1,i.root.onParamsChange(i.col.field,t)},this.setSelected=function(t){i.status.selected=t},this.setSelected=this.setSelected.bind(this),this.$onInit=function(){var t=i;i.status.selected=null;var e=i.root.config.params;Object.keys(e).forEach(function(n){n===t.col.field&&(t.status.selected=t.options.find(function(t){return t.value===e[n]}))}),i.ngDatatableTh.ngDatatableThFilter=i},this.$postLink=function(){a(function(){n.on("click",l),o&&n.on("touchstart",l)},0)},this.$destroy=function(){n.off("click",l),o&&n.off("touchstart",l)}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}a.$inject=["$scope","$element","$document","$timeout"],l.component("ngDatatableThFilter",{bindings:{options:"<",col:"<",root:"<"},require:{ngDatatableTh:"^"},template:'<ng-include src="vm.getTemplateUrl()"></ng-include>',controller:a,controllerAs:"vm"})}(window,window.angular),function(t,e,n){function a(){var t=this;this.status={},this.getTemplateUrl=function(){var e=t.root.templateUrls;return e["th_"+t.col.field]||e.th},this.onFilterTrigger=function(){t.status.filterOpen=!t.status.filterOpen},this.onFilterTrigger=this.onFilterTrigger.bind(this),this.onSort=function(){var e={};e=t.config.sortOptions.sortBy!==t.col.field?{sortBy:t.col.field,order:"asc"}:"asc"===t.config.sortOptions.order?{sortBy:t.col.field,order:"desc"}:t.config.sortDefaults,t.root.onSort(e)},this.$onInit=function(){t.root=t.ngDatatable,t.root.colViews[t.col.field]=t}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.component("ngDatatableTh",{bindings:{col:"<",config:"<"},require:{ngDatatable:"^"},template:'<ng-include src="vm.getTemplateUrl()"></ng-include>',controller:a,controllerAs:"vm"})}(window,window.angular);
//# sourceMappingURL=ng-datatable.min.js.map
