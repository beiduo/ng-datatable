"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e,n){function a(t){var e=this;this.buildData=function(t,n){e.receive=n,e.config=t,e.data=e.buildGroup(t,n),e.dataFilter(),e.dataSort(),e.rows=e.buildPlainRows()},this.buildData=this.buildData.bind(this),this.dataFilter=function(){var t=e,a=e.config.params;"object"===("undefined"==typeof a?"undefined":_typeof(a))&&Object.keys(a).forEach(function(e){if(null!==a[e]&&a[e]!==n&&""!==a[e]){var l=t.config.cols.find(function(t){return t.field===e});l&&"object"===_typeof(l.filterOptions)&&t.data.rows.forEach(function(t){t.children=t.children.filter(function(t){return t.entity[e]===l.filterOptions.find(function(t){return t.value===a[e]}).name})})}})},this.dataSort=function(){var t=e;e.data.rows.forEach(function(e){var n=t.config.sortOptions;e.children=e.children.sort(function(t,e){return"desc"===n.order?e.entity[n.sortBy]-t.entity[n.sortBy]:t.entity[n.sortBy]-e.entity[n.sortBy]})})},this.buildGroup=function(t,e){var n={};return t.enableGrouping?n.rows=e.rows.map(function(e){var n={};return"object"===_typeof(e[t.groupBy])?n.parent=Object.assign({},e[t.groupBy]):n.parent={name:e[t.groupBy]},Array.isArray(e[t.groupIn])&&(n.children=e[t.groupIn].map(function(t){return{entity:t}})),n}):n.rows=[{children:e.rows.map(function(t){return{entity:t}})}],"function"==typeof t.dataSerialize&&n.rows.forEach(function(e){e.children.forEach(function(e){e.entity=t.dataSerialize(e.entity)})}),n},this.buildPlainRows=function(){var t=[];return e.data.rows.forEach(function(e){e.children.forEach(function(e){t[t.length]=e})}),t},this.onSelectAll=function(){var t=e.config.isRowSelectable;e.allSelected?(e.rows.forEach(function(e){("function"!=typeof t||t(e))&&(e.isSelected=!0)}),e.data.rows.forEach(function(t){t.isSelected=!0})):(e.rows.forEach(function(e){("function"!=typeof t||t(e))&&(e.isSelected=!1)}),e.data.rows.forEach(function(t){t.isSelected=!1}))},this.onSort=function(t){"object"===("undefined"==typeof t?"undefined":_typeof(t))&&(e.config.sortOptions=Object.assign({},e.config.sortOptions,t),"function"==typeof e.config.onFetch?e.config.onFetch(Object.assign({},e.config.params,e.config.sortOptions)):(e.dataSort(),e.rows=e.buildPlainRows()))},this.onSort=this.onSort.bind(this),this.onParamsChange=function(t,n){"string"==typeof t&&(e.config.params[t]=n?n.value:null),"function"==typeof e.config.onFetch?e.config.onFetch(Object.assign({},e.config.params,e.config.sortOptions)):e.buildData(e.config,e.receive)},this.onParamsChange=this.onParamsChange.bind(this),this.getThClass=function(t){var e=[];return t.alignRight&&e.push("align-right"),e.push("col-"+t.field+"-th"),e.join(" ")},this.$onInit=function(){var a=e;e.colViews={},e.templateUrls={table:"ng-datatable-table.html",th:"ng-datatable-th.html",thFilter:"ng-datatable-th-filter.html",groupHeader:"ng-datatable-group-header.html",ceil:"ng-datatable-ceil.html"},"string"==typeof e.config.tableTemplateUrl&&(e.templateUrls.table=e.config.tableTemplateUrl),"string"==typeof e.config.tableTemplate&&(t.put("ng-datatable-custom-table",e.config.tableTemplate),e.templateUrls.table="ng-datatable-custom-table"),"string"==typeof e.config.theadCeilTemplateUrl&&(e.templateUrls.th=e.config.theadCeilTemplateUrl),"string"==typeof e.config.theadCeilTemplate&&(t.put("ng-datatable-custom-th",e.config.theadCeilTemplate),e.templateUrls.th="ng-datatable-custom-th"),"string"==typeof e.config.filterTemplateUrl&&(e.templateUrls.thFilter=e.config.filterTemplateUrl),"string"==typeof e.config.filterTemplate&&(t.put("ng-datatable-custom-th-filter",e.config.filterTemplate),e.templateUrls.thFilter="ng-datatable-custom-th-filter"),"string"==typeof e.config.groupHeaderTemplateUrl&&(e.templateUrls.groupHeader=e.config.groupHeaderTemplateUrl),"string"==typeof e.config.groupHeaderTemplate&&(t.put("ng-datatable-custom-group-header",e.config.groupHeaderTemplate),e.templateUrls.groupHeader="ng-datatable-custom-group-header"),"string"==typeof e.config.ceilTemplateUrl&&(e.templateUrls.ceil=e.config.ceilTemplateUrl),"string"==typeof e.config.ceilTemplate&&(t.put("ng-datatable-custom-ceil",e.config.ceilTemplate),e.templateUrls.ceil="ng-datatable-custom-ceil"),e.config.cols.forEach(function(e){return"string"!=typeof e.field?void console.error("each column must has a field property, otherwise some functions might not work. if this column doesn't connect with any field in your data, just use any radom field name."):("string"==typeof e.theadCeilTemplateUrl&&(a.templateUrls["th_"+e.field]=e.theadCeilTemplateUrl),"string"==typeof e.filterTemplateUrl&&(a.templateUrls["filter_"+e.field]=e.filterTemplateUrl),"string"==typeof e.ceilTemplateUrl&&(a.templateUrls["ceil_"+e.field]=e.ceilTemplateUrl),"string"==typeof e.theadCeilTemplate&&(t.put("ng-datatable-th_"+e.field,e.theadCeilTemplate),a.templateUrls["th_"+e.field]="ng-datatable-th_"+e.field),"string"==typeof e.filterTemplate&&(t.put("ng-datatable-th-filter_"+e.field,e.filterTemplate),a.templateUrls["thFilter_"+e.field]="ng-datatable-th-filter_"+e.field),void("string"==typeof e.ceilTemplate&&(t.put("ng-datatable-ceil_"+e.field,e.ceilTemplate),a.templateUrls["ceil_"+e.field]="ng-datatable-ceil_"+e.field)))}),e.config.enableGrouping&&(e.config=Object.assign({},{groupBy:"parent",groupIn:"chilren"},e.config)),e.config.sortOptions=Object.assign({},e.config.sortDefaults),e.buildData(e.config,e.receive),e.api={getRows:function(){return e.rows},getSelections:function(){return e.rows.filter(function(t){return t.isSelected})},selectAllRows:function(){e.allSelected=!0,e.onSelectAll()},unselectAllRows:function(){e.allSelected=!1,e.onSelectAll()},getRowsBy:function(t){return e.rows.filter(function(e){return Object.keys(t).every(function(n){return t[n]===e.entity[n]})})},getParams:function(){return e.config.params},setData:function(t){e.buildData(e.config,t)},setParams:function(t){var a=e;return"object"!==("undefined"==typeof t?"undefined":_typeof(t))?void console.error("setParams method requires an object as its first parameter"):(e.config.params=Object.assign({},e.config.params,t),e.onParamsChange(),void Object.keys(t).forEach(function(e){var l=void 0;l=null===t[e]||t[e]===n||""===t[e]?null:a.colViews[e].ngDatatableThFilter.options.find(function(n){return n.value===t[e]}),a.colViews[e].ngDatatableThFilter.setSelected(l)}))},getView:function(){return e},disableSelection:function(){e.config.enableSelection=!1},enableSelection:function(){e.config.enableSelection=!0},toggleSelection:function(){e.config.enableSelection=!e.config.enableSelection},disableGroupHeaderSelection:function(){e.config.enableGroupHeaderSelection=!1},enableGroupHeaderSelection:function(){e.config.enableGroupHeaderSelection=!0},disableSelectAll:function(){e.config.enableSelectAll=!1},enableSelectAll:function(){e.config.enableSelectAll=!0}},Object.keys(e.api).forEach(function(t){e.api[t]=e.api[t].bind(a)}),"function"==typeof e.config.apiRegister&&e.config.apiRegister(e.api)},console.log(this)}var l;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}a.$inject=["$templateCache"],l.component("ngDatatable",{bindings:{config:"<",receive:"<"},template:"<ng-include src=\"vm.templateUrls['table']\"></ng-include>",controller:a,controllerAs:"vm"})}(window,window.angular),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-ceil.html","<div class=\"ceil\">{{vm.applyFilter(vm.row.entity[vm.field], vm.col.filter) || '-'}}</div>")}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-group-header.html",'<div class="ceil"><div class="group-caption">{{vm.receive.name}}</div><a href="javascript:;" class="triangle group-trigger" ng-class="{\'group-trigger-open\': vm.ngDatatableGroup.status.groupOpen}">收起</a></div>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-group.html",'<tr class="group-header" ng-if="vm.group.parent"><td class="select-ceil" ng-if="vm.root.config.enableSelection"><div class="ceil" ng-if="vm.root.config.enableGroupHeaderSelection"><label class="ng-datatable-check"><input type="checkbox" ng-model="vm.group.isSelected" ng-click="vm.onGroupSelect()"> <span class="text"></span></label></div></td><td colspan="{{vm.root.config.cols.length}}"><ng-datatable-group-header ng-click="vm.onGroupOpen()" receive="vm.group.parent" root="vm.root"></ng-datatable-group-header></td></tr><tr ng-datatable-row="" ng-repeat="el in vm.group.children" row="el" group="vm.group" ng-show="vm.status.groupOpen" root="vm.root"></tr>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-row.html",'<td class="select-ceil" ng-if="vm.root.config.enableSelection"><div class="ceil"><label class="ng-datatable-check"><input type="checkbox" ng-disabled="!vm.root.config.isRowSelectable(vm.row)" ng-model="vm.row.isSelected" ng-change="vm.onRowSelect()"> <span class="text"></span></label></div></td><td ng-repeat="el in vm.root.config.cols" data-ref="{{el.field}}" ng-class="vm.getTdClass(el)"><ng-datatable-ceil field="el.field" row="vm.row" col="el" root="vm.root"></ng-datatable-ceil></td>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-table.html",'<table class="maintable"><thead><tr><th class="select-ceil" ng-if="vm.config.enableSelection"><div class="ceil" ng-if="vm.config.enableSelectAll"><label class="ng-datatable-check"><input type="checkbox" ng-model="vm.allSelected" ng-change="vm.onSelectAll()"> <span class="text"></span></label></div></th><th ng-repeat="el in vm.config.cols" data-ref="el.field" ng-class="vm.getThClass(el)"><ng-datatable-th col="el" config="vm.config" root="vm"></ng-datatable-th></th></tr></thead><tbody ng-datatable-group="" ng-repeat="el in vm.data.rows" group="el" root="vm"></tbody></table>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-th-filter.html",'<ul class="filter-options"><li ng-class="{ current: !vm.status.selected }"><a href="javascript:;" ng-click="vm.onfilterSelect(null)">全部</a></li><li ng-repeat="option in vm.options track by $index" ng-class="{ current: option == vm.status.selected }"><a href="javascript:;" ng-click="vm.onfilterSelect(option)">{{option.name}}</a></li></ul>')}])}(),function(t){try{t=angular.module("ng-datatable")}catch(e){t=angular.module("ng-datatable",[])}t.run(["$templateCache",function(t){t.put("ng-datatable-th.html",'<div class="thead-ceil with-filter"><div class="title">{{vm.col.displayName}}</div><a href="javascript:;" class="sort" ng-if="vm.col.enableSort" ng-class="{ \'sort-asc\': vm.config.sortOptions.sortBy === vm.col.field && vm.config.sortOptions.order === \'asc\', \'sort-desc\': vm.config.sortOptions.sortBy === vm.col.field && vm.config.sortOptions.order === \'desc\' }" ng-click="vm.onSort()"><span class="text">排序</span></a> <a href="javascript:;" class="triangle filter-trigger" ng-class="{ \'filter-trigger-open\': vm.status.filterOpen }" ng-click="vm.onFilterTrigger()" ng-if="vm.col.enableFilter">过滤</a><ng-datatable-th-filter ng-class="{show: vm.status.filterOpen}" ng-if="vm.col.enableFilter" options="vm.col.filterOptions" col="vm.col" root="vm.root"></ng-datatable-th-filter></div>')}])}(),function(t,e,n){function a(t){var e=this;this.getTemplateUrl=function(){var t=e.root.templateUrls;return t["ceil_"+e.col.field]||t.ceil},this.applyFilter=function(n,a){if(a){var l=a.split(":"),o=l[0],i=[n];return l.length>1&&(i=i.concat(l.slice(1))),t(o).apply(e,i)}return n}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}a.$inject=["$filter"],l.component("ngDatatableCeil",{bindings:{row:"<",field:"<",col:"<",root:"<"},require:{ngDatatableRow:"^"},template:'<ng-include src="vm.getTemplateUrl()"></ng-include>',controller:a,controllerAs:"vm"})}(window,window.angular),function(t,e,n){function a(){}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.component("ngDatatableGroupHeader",{bindings:{receive:"<",root:"<"},require:{ngDatatableGroup:"^"},template:"<ng-include src=\"vm.root.templateUrls['groupHeader']\"></ng-include>",controller:a,controllerAs:"vm"})}(window,window.angular),function(t,e,n){function a(){var t=this;this.status={groupOpen:!0},this.onGroupOpen=function(){t.status.groupOpen=!t.status.groupOpen},this.onGroupOpen=this.onGroupOpen.bind(this),this.onGroupSelect=function(){var e=t.root.config.isRowSelectable;t.group.isSelected?t.group.children.forEach(function(t){("function"!=typeof e||e(t))&&(t.isSelected=!0)}):(t.root.allSelected=!1,t.group.children.forEach(function(t){("function"!=typeof e||e(t))&&(t.isSelected=!1)}))},this.$onInit=function(){t.root=t.ngDatatable}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.directive("ngDatatableGroup",function(){return{restrict:"EA",templateUrl:"ng-datatable-group.html",scope:{group:"="},require:{ngDatatable:"^"},controller:a,controllerAs:"vm",bindToController:!0}})}(window,window.angular),function(t,e,n){function a(){var t=this;this.onRowSelect=function(){t.row.isSelected||(t.root.allSelected=!1,t.group.isSelected=!1)},this.getTdClass=function(t){var e=[];return t.alignRight&&e.push("align-right"),e.push("col-"+t.field+"-td"),e.join(" ")}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.directive("ngDatatableRow",function(){return{restrict:"EA",templateUrl:"ng-datatable-row.html",scope:{row:"=",group:"=",root:"="},require:{ngDatatableGroup:"^"},controller:a,controllerAs:"vm",bindToController:!0}})}(window,window.angular),function(t,e,n){function a(t,e,n,a){function l(t){var n=e[0],a=n.parentNode.querySelector("a.filter-trigger"),l=t.target,o=!1;if(t&&l&&n){for(;l;l=l.parentNode)if(l===n||l===a){o=!0;break}o||r.onClose()}}function o(){return"ontouchstart"in window||navigator.maxTouchPoints}var i=this,r=this;this.status={},this.getTemplateUrl=function(){var t=i.root.templateUrls;return t["thFilter_"+i.col.field]||t.thFilter},this.onClose=function(){var e=i;t.$apply(function(){e.ngDatatableTh.status.filterOpen=!1})},this.onfilterSelect=function(t){i.status.selected=t,i.ngDatatableTh.status.filterOpen=!1,i.root.onParamsChange(i.col.field,t)},this.setSelected=function(t){i.status.selected=t},this.setSelected=this.setSelected.bind(this),this.$onInit=function(){var t=i;i.status.selected=null;var e=i.root.config.params;Object.keys(e).forEach(function(n){n===t.col.field&&(t.status.selected=t.options.find(function(t){return t.value===e[n]}))}),i.ngDatatableTh.ngDatatableThFilter=i},this.$postLink=function(){a(function(){n.on("click",l),o&&n.on("touchstart",l)},0)},this.$destroy=function(){n.off("click",l),o&&n.off("touchstart",l)}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}a.$inject=["$scope","$element","$document","$timeout"],l.component("ngDatatableThFilter",{bindings:{options:"<",col:"<",root:"<"},require:{ngDatatableTh:"^"},template:'<ng-include src="vm.getTemplateUrl()"></ng-include>',controller:a,controllerAs:"vm"})}(window,window.angular),function(t,e,n){function a(){var t=this;this.status={},this.getTemplateUrl=function(){var e=t.root.templateUrls;return e["th_"+t.col.field]||e.th},this.onFilterTrigger=function(){t.status.filterOpen=!t.status.filterOpen},this.onFilterTrigger=this.onFilterTrigger.bind(this),this.onSort=function(){var e={};e=t.config.sortOptions.sortBy!==t.col.field?{sortBy:t.col.field,order:"asc"}:"asc"===t.config.sortOptions.order?{sortBy:t.col.field,order:"desc"}:t.config.sortDefaults,t.root.onSort(e)},this.$onInit=function(){t.root=t.ngDatatable,t.root.colViews[t.col.field]=t}}var l=void 0;try{l=e.module("ng-datatable")}catch(t){l=e.module("ng-datatable",[])}l.component("ngDatatableTh",{bindings:{col:"<",config:"<"},require:{ngDatatable:"^"},template:'<ng-include src="vm.getTemplateUrl()"></ng-include>',controller:a,controllerAs:"vm"})}(window,window.angular);
//# sourceMappingURL=ng-datatable.min.js.map
